---
title: Rails and Rack Configuration
products: ["rails"]
category: manifest
---

## Rails

A Rails application type in the manifest file gives you fine control over things like the Ruby version or the server the rails application is deployed on.

|Option|Applied on|Description|Clouds|
|--- |--- |--- |--- |
|`activeprotect`|<Glyph icon="redeploy" />|The parent node for ActiveProtect settings (see `whitelist` and `http_ban_rate` below)|All|
|`activeprotect / whitelist`|<Glyph icon="redeploy" />|A comma-separated whitelist of IPs that should be ignored by your ActiveProtect configuration. Must be nested under `activeprotect`.|All|
|`activeprotect / http_ban_rate`|<Glyph icon="redeploy" />|Set the threshold of *requests per minute* from a single IP address. The default is `2000`. Must be nested under `activeprotect`.|All|
|`asset_pipeline_precompile`|<Glyph icon="redeploy" />|Specify whether to use asset pipeline compilation - this will be taken into account during redeployment. NOTE: **Rails only** - does not apply to other Rack servers.|All|
|`bundler / options`|<Glyph icon="redeploy" />|Customise your `bundle install` command by specifying options. [See below](#examples-of-bundle-install-options-railsrack) for some example options and defaults.|All|
|`do_initial_db_schema_load`|<Glyph icon="build" />|Specify whether to perform `rake db:schema:load` on a new application build.|All|
|`firewall / create_web_rules`|<Glyph icon="redeploy" />|Cloud 66 automatically creates firewall rules to expose your web application to the outside world. You can configure this via your [Traffic settings](/:product/:version?/networking/network-configuration#firewall), or disable it completely by setting this value to `false`. Default is `true`.|All|
|`iam_instance_profile_name`|<Glyph icon="build" />|The name of the [IAM instance profile](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles/) that should be used when provisioning this server. [Read our guide](/:product/:version?/build-and-config/advanced-cloud-configurations#using-iam-instance-profiles-with-your-servers).|AWS|
|`include_submodules`|<Glyph icon="redeploy" />|Set this to `false` to exclude any Git submodules from being pulled during a build. Default is `true`|All|
|`instance_service_account_name`|<Glyph icon="build" />|The name of the [GCE Service Account](/:product/:version?/build-and-config/advanced-cloud-configurations#using-gce-service-accounts-with-cloud-66) that should be used when provisioning this server.|GCE|
|`keep_releases`|<Glyph icon="redeploy" />|Specify the number of releases to keep on your server(s). Default is `5`.|All|
|`locked_passenger_version`|<Glyph icon="upgrade" />|Force the app to use a specific version of Passenger. This is not supported on Passenger Enterprise applications.|All|
|`memory_allocator`|<Glyph icon="upgrade" />|The memory allocation library that will be used for your Ruby installation. Options are `malloc` or `jemalloc`. Defaults to `malloc`.|All|
|`nameservers`|<Glyph icon="build" />|Set DNS servers for your application.  Note that if you specify empty array i.e **[ ]**, it won't add any nameserver to your servers. Default is an empty array: `[ ]`|All|
|`network` / `mode`|<Glyph icon="build" />|Specifies whether your servers should communicate over `private` or `public` IP addresses. Defaults to `private` if your servers are *either* all cloud *or* all [Registered](/:product/:version?/servers/registered-servers). If your application uses a *mix* of cloud and Registered servers, the default will be `public`.|All|
|`operating_system`|<Glyph icon="build" />|The version of Ubuntu to install on the server that hosts your application. Accepted values: <OperatingSystemsWrapper showAll={true} humanReadable={false} /> - this is [governed by Ruby version](/:product/:version?/build-and-config/managing-and-upgrading-ruby-versions#ruby-and-ubuntu-versions).|All|
|`passenger_process_memory`|<Glyph icon="redeploy" />|A value (in MB) that Cloud 66 will use for each Passenger process. This is also used to calculate the value of the `passenger_pool_max` variable in your [Nginx configuration](/:product/:version?/servers/nginx#pool-max) which in turn sets `passenger_max_pool_size`.|All|
|`reserved_server_memory`|<Glyph icon="redeploy" />|A value in MB that Cloud 66 will assume should be left available. This will affect any automatically calculated values.|All|
|`root_disk_size`|<Glyph icon="build" />|Default size of root disk (in GB) for servers used by application. Default value is 50.|AWS, Azure, GCE|
|`root_disk_type`|<Glyph icon="build" />|Disk type, accepted values being `ssd` and `magnetic`. Default is `ssd`.|AWS, GCE|
|`ruby_version`|<Glyph icon="upgrade" />|Specify the version of Ruby to use. Also applies when you want to [upgrade your Ruby version](/:product/:version?/build-and-config/managing-and-upgrading-ruby-versions). We recommend that you use this and *remove the Ruby version declaration from your Gemfile* to avoid situations where your application will not run on every server during an upgrade. Older versions of Ruby will [limit the version of Ubuntu](/:product/:version?/build-and-config/managing-and-upgrading-ruby-versions#ruby-and-ubuntu-versions) your servers can use.|All|
|`subnet_id`|<Glyph icon="build" />|**ID** or **name** of the AWS subnet in which you would like to create your servers. If not supplied, we will attempt to identify the single subnet with [map_public_ip_on_launch](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-subnet#cfn-ec2-subnet-mappubliciponlaunch) set to true|AWS|
| `tags` | <Glyph icon="build" /> | Append the listed tags to any servers created for this component. See our [tagging guide](/:product/:version?/servers/tagging-components) for more info on tag syntax and support. | AWS, Azure, DigitalOcean, Hetzner |
|`vn_name`|<Glyph icon="build" />|The name of the Virtual Network in which you would like to create your servers.|Azure|
|`vpc_id`|<Glyph icon="build" />|**ID** or **name** of the VPC in which you would like to create your servers.|AWS, Azure, DigitalOcean, Hetzner|

<Callout type="warning" title="AWS VPC requires subnet_id">
In order to use an AWS *vpc_id*, you must provide *subnet_id* for all servers used by your application.
</Callout>

### Example YAML for Rails

```yaml
rails:
  configuration:
    ruby_version: 2.7.2
    asset_pipeline_precompile: true
    bundler:
      options:
        without: ["development", "test", "custom"]
    do_initial_db_schema_load: false
    reserved_server_memory: 0 #default value
    passenger_process_memory: 200 #default value
    memory_allocator: jemalloc # malloc is default
    locked_passenger_version: 4.0.59
    activeprotect:
      whitelist: 123.123.123.123,234.234.234.234
      http_ban_rate: 2000 # Default
    vpc_id: my-vpc-name
    root_disk_size: 100
    root_disk_type: ssd
    nameservers: ['8.8.8.8', '8.8.4.4']
    iam_instance_profile_name: rails-perms
```

## Deployment Success Checks

These checks define tests to confirm whether your application has been successfully deployed, and to mark a deployment as "failed" if any do not pass. For more details on health checks please read our [how-to guide](/:product/:version?/servers/application-health-checks#deployment-success-checks). Health Checks have the following Manifest options:

|Option|Applied on|Description|Clouds|
|--- |--- |--- |--- |
|`protocol`|<Glyph icon="redeploy" />|The protocol(s) to use when running the check(s). Acceptable values are `http` or `https`.|All|
|`host`|<Glyph icon="redeploy" />|The hostname or IP address that will we called during the check.|All|
|`port`|<Glyph icon="redeploy" />|The port number that must be used when submitting the request. The default is `80` if you set `http` as your protocol and `443` if you set it to `https`|All|
|`endpoint`|<Glyph icon="redeploy" />|The URL, path or endpoint that should be checked. This can be any URL in the application.|All|
|`accept`|<Glyph icon="redeploy" />|A comma separated list of the HTTP response codes that should be considered as a "pass" of this check. All values must be enclosed in quotes.  Ranges can be defined with dashes and both the first and last port numbers must be included. For example `["200-201", "300-305"]`|All|
|`follow_redirects`|<Glyph icon="redeploy" />|Whether to follow redirects when performing the check. The default value is true.|All|
|`timeout`|<Glyph icon="redeploy" />|The wait, in seconds, before the check will time out. The max is 120.|All|

### Example YAML for Deployment Success Checks

```yaml
  rails:
    configuration:
      health_check:
        protocol: 'http'
        host: '127.0.0.1'
        port: 80
        endpoint: '/'
        accept: ["200"]
        follow_redirects: true
        timeout: 30
```

## Node version (for Rails applications)

We automatically install the latest release of Node version 16.x.x when we set up your Rack.. application servers. You can control which version is installed by editing the manifest file for any Rails application as follows:

```yaml
rails:
  configuration:
    node_version: "18"       # will install latest release of v18.x.x
```

```yaml
rails:
  configuration:
    node_version: "18.1"  # will install latest v18.1.x
```

If you need a newer version of Node, you can install one using the same method above. We support any version of Node that is supported by our [version manager](https://github.com/tj/n) (which itself supports the [Node distribution list](https://nodejs.org/dist/)).

<Callout type="warning" title="Applying changes">
To apply changes to the Node version you need to update your manifest file, then deploy-with-options and select the **Apply Ruby/Node upgrades** option.
</Callout>

## Rack

For Rack you should use the same settings as Rails but the top node in your YAML **must** be `rack` (see below). Also note that `asset_pipeline_precompile` only applies to Rails servers. 

### Example YAML for Rack

```yaml
rack:
  configuration:
    ruby_version: 2.7.2
    do_initial_db_schema_load: false
    reserved_server_memory: 0 #default value
    passenger_process_memory: 200 #default value
    memory_allocator: jemalloc # malloc is default
    locked_passenger_version: 4.0.59
    activeprotect:
      whitelist: 123.123.123.123,234.234.234.234
    vpc_id: vpc-64872001
    root_disk_size: 100
    root_disk_type: ssd
    nameservers: ['8.8.8.8', '8.8.4.4']
    iam_instance_profile_name: rack-perms
```

## Sinatra

For Sinatra use [Rack](#rack)